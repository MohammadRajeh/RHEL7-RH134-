Exercise Description
    This exercise will walk you through the steps required to handle AVC messages that are generated by SELinux, when an application violates existing policy. We will modify the already-created generic policy, in order to allow the application to run correctly, when we switch the policy to enforcing mode.

    Step 1: Check for AVC denials
    Now that our app is up and running, we can check the system logs for AVC (access vector cache, where SELinux caches decisions to grant or deny access) denial messages.

  # sudo ausearch -m AVC -ts today

Section 1: Update the policy to allow access to /proc
Step 1: Interpret AVC messages
        In the first audit message, we see these AVC messages:

      

        type=AVC msg=audit(1552588580.764:25971): avc:  denied  { open } for  pid=1022 comm="testapp" path="/proc/meminfo" dev="proc" ino=4026532040 scontext=system_u:system_r:testapp_t:s0 tcontext=system_u:object_r:proc_t:s0 tclass=file permissive=1
        type=AVC msg=audit(1552588580.764:25971): avc:  denied  { read } for  pid=1022 comm="testapp" name="meminfo" dev="proc" ino=4026532040 scontext=system_u:system_r:testapp_t:s0 tcontext=system_u:object_r:proc_t:s0 tclass=file permissive=1
        If we look at them both closely, we can see that the testapp process is being denied open on /proc/meminfo, and read on /proc, in general. So, we need to find the interface that will allow those accesses, and add it to our testapp.te file.

Step 2: Find the right interface
    SELinux interface definitions are located in /usr/share/selinux/devel/include, if you install the selinux-policy-devel package. If we search for /proc, in files named *.if (interface definitions):

   # cd /usr/share/selinux/devel/include
   # find . -type f -name "*.if" -exec grep -H '/proc' {} \; | grep "system state information"

        We see that in the results, there is a line that says:

        ./kernel/kernel.if:##	Allows caller to read system state information in /proc.

Step 3: Add the interface to the policy
    To allow this, add the interface to testapp.te, with a line, in the testapp local policy section, like this:

    kernel_read_system_state(testapp_t)
   # cat ~/src/policy/testapp.te

Step 4: Recompile and reload the policy
        Now, let’s recompile the policy, and reload it into memory.

   # cd ~/src/policy
   # sudo ./testapp.sh
Step 5: Restart the application
    To see if that fixed the problem, let’s restart the application:

   # sudo systemctl restart testapp
    …​and see if there are any AVC messages about /proc:

   # sudo ausearch -m AVC -ts recent | grep meminfo | wc -l
    0
